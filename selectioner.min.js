(function(e){Selectioner={Extensions:{},Dialog:{},Display:{},Popup:{}},function(){var t=Selectioner.Popup.Base=function(){};t.prototype.initialize=function(t,n,i){this.select=t,this.display=n,this.dialogView=i,this.element=e("<div />").addClass("select-dialog").css({display:"none",position:"absolute"}),this.render();var l=this;this.display.element.on("focusin.selectioner",function(){l.show(),n.element.on("mousedown.hide-select",function(){l.isShown()?l.hide():l.show()})}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!l.isShown()||t.target===l.display.element[0]||e.contains(l.display.element[0],t.target)||t.target===l.element[0]||e.contains(l.element[0],t.target)||(n.element.off("mousedown.hide-select"),l.hide())}),e("body").append(this.element)},t.prototype.reposition=function(){var e=this.display.element.offset(),t=this.element.outerWidth(!1)-this.element.width();this.element.css({width:this.display.element.outerWidth(!1)-t+"px",left:e.left+"px",top:this.display.element.outerHeight(!1)+e.top+"px"})},t.prototype.render=function(){this.element.empty().append(this.dialogView.render())},t.prototype.show=function(){this.render(),this.reposition(),this.element.css("display",""),this.select.trigger("show-dialog.selectioner")},t.prototype.hide=function(){this.element.css("display","none"),this.select.trigger("hide-dialog.selectioner")},t.prototype.isShown=function(){return this.element.is(":visible")}}(),function(){var t=Selectioner.Display.Base=function(){};t.prototype.initialize=function(t,n){this.select=t,this.element=this.render(),this.select.css("display","none").after(this.element);var i=this,l=t.attr("id");void 0!==l&&e('label[for="'+l+'"]').on("click",function(){i.element.focus()}),this.select.on("change.selectioner",function(){i.update()}).on("show-dialog.selectioner",function(){i.element.addClass("select-visible")}).on("hide-dialog.selectioner",function(){i.element.removeClass("select-visible")}),n.initialize(t);var o=new Selectioner.Popup.Base;o.initialize(t,this,n)},t.prototype.render=function(){this.element=e("<span />").prop("tabindex",this.select.prop("tabindex")).addClass("select-display"),this.textElement=e("<span />").addClass("select-text");var t=e("<span />").addClass("select-button");this.element.append(t).append(this.textElement),this.update()},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None"),this.textElement.addClass("none");else if(2>=e.length){for(var t="",n=0,i=e.length;i>n;n++)t+=e[n].text,i-1>n&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Display.ListBox=function(){};t.prototype=new Selectioner.Display.Base,t.prototype.render=function(){var t=e("<span />").prop("tabindex",this.select.prop("tabindex")).addClass("select-display");this.textElement=e("<span />").addClass("select-text");var n=e("<span />").addClass("select-button");return t.append(n).append(this.textElement),this.update(),t},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None").addClass("none");else if(2>=e.length){for(var t="",n=0,i=e.length;i>n;n++)t+=e[n].text,i-1>n&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Display.ComboBox=function(){};t.prototype=new Selectioner.Display.Base,t.prototype.render=function(){var t=e("<span />").prop("tabindex",this.select.prop("tabindex")).addClass("select-display");this.inputElement=e('<input type="text" />').attr("placeholder","None").addClass("select-text");var n=e("<span />").addClass("select-button");return t.append(n).append(this.inputElement),this.update(),t},t.prototype.update=function(){var e=this.select.find("option:selected");this.inputElement.removeAttr("placeholder").removeClass("none"),0===e.length?this.inputElement.addClass("none"):this.inputElement.val(e.text())}}(),function(){var t=Selectioner.Dialog.Base=function(){};t.prototype.initialize=function(e){this.select=e},t.prototype.render=function(){for(var t=e("<ul />"),n=this.select.children(),i=0,l=n.length;l>i;i++){var o=e(n[i]);"OPTION"===n[i].tagName?t.append(this.renderOption(o)):"OPTGROUP"===n[i].tagName&&t.append(this.renderOptionGroup(o))}return t}}(),function(){var t=Selectioner.Dialog.SingleSelect=function(){};t.prototype=new Selectioner.Dialog.Base,t.prototype.renderOption=function(t){var n=this.select,i=function(){t[0].selected=!0,n.trigger("change.selectioner")},l=e("<a />").attr("href","javascript:;").on("click",i).text(t.text());return e("<li />").append(l)},t.prototype.renderOptionGroup=function(t){for(var n=e("<span />").text(t.attr("label")),i=e("<li />").addClass("select-group-title").append(n),l=t.children(),o=0,s=l.length;s>o;o++){var a=e(l[o]);i=i.add(this.renderOption(a))}return e("<li />").append(e("<ul >").append(i))}}(),function(){var t=0,n=Selectioner.Dialog.MultiSelect=function(){};n.prototype=new Selectioner.Dialog.Base,n.prototype.renderOption=function(n){var i=e("<li />"),l="MultiSelectCheckbox"+t++,o=e('<input type="checkbox" />').attr("id",l);n[0].selected&&o.attr("checked","checked");var s=e("<label />").append(o).append(e("<span />").text(n.text())).attr("for",l),a=this;return o.on("change.selectioner",function(){n[0].selected=this.checked,a.select.trigger("change.selectioner")}),i.append(s),i},n.prototype.renderOptionGroup=function(t){for(var n=function(){var t=e(this).closest("ul").find("input:checkbox"),n=t.filter(":checked").length;n>0&&t.length===n?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.selectioner")},i=e("<a />").attr("href","javascript:;").on("click",n).text(t.attr("label")),l=e("<li />").addClass("select-group-title").append(i),o=t.children(),s=0,a=o.length;a>s;s++){var r=e(o[s]);l=l.add(this.renderOption(r))}return e("<li />").append(e("<ul >").append(l))}}(),e.fn.singleSelect=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.SingleSelect)})},e.fn.multiSelect=function(){this.filter("select[multiple]").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.MultiSelect)})},e.fn.comboSelect=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Display.ComboBox;t.initialize(e(this),new Selectioner.Dialog.SingleSelect)})}})(jQuery);