(function(e){"use strict";var t=function(){};t.prototype.on=function(e,t,i){var n=e.split(" ");return n.length>1?n.forEach(function(e){this.on(e,t,i)},this):(this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push({handler:t,context:i?i:this})),this},t.prototype.off=function(e,t){if(!this._eventHandlers)return this;var i=function(e,t){for(var i=0,n=this._eventHandlers[e].length;n>i;i++)this._eventHandlers[e][i].handler==t&&this._eventHandlers[e].splice(i,1)};if(e)if(e&&!t)if("function"!=typeof e){if(!this._eventHandlers[e])return this;this._eventHandlers[e].length=0}else{var n=e;for(var o in this._eventHandlers)i.call(this,o,n)}else{if(!this._eventHandlers[e])return this;i.call(this,e,t)}else delete this._eventHandlers;return this},t.prototype.trigger=function(e,t){if(this._eventHandlers){var i=this._eventHandlers[e];if(i)for(var n=this,o=0,s=i.length;s>o;o++){var r=i[o];r.handler.call(r.context,{target:n,name:e,data:t})}return this}};var i=window.Selectioner=function(t,n,o,s){this.settings=i.DefaultSettings;for(var r in s)this.settings[r]=s[r];if(this.id=i._idSeed++,o instanceof Array||(o=[o]),this.target=t=e(t),this.display=n,this.dialogs=o,t.data("selectioner"))throw Error("The target element has already has a Selectioner associated with it.");t.next().hasClass(this.settings.cssPrefix+"display")&&t.next().remove(),n.initialize(this);for(var l=0,a=o.length;a>l;l++)n.addDialog(o[l]);t.data("selectioner",this).css("display","none").after(this.display.element)};i.prototype=new t,i._idSeed=0,i.Core={},i.Dialog={},i.Display={},i.Extensions={},i.Popup={},i.DefaultSettings={cssPrefix:"select-",noSelectionText:"Select an option",emptyOptionText:"None",noOptionText:"No Options Available",maxAutoCompleteItems:5};var n=function(){};n.prototype.initialize=function(t){var i=this;this.selectioner=t,this.dialogs=[],this._dialogFocusIndex=null,this.element=e("<div />").addClass(this.selectioner.settings.cssPrefix+"popup").css({visibility:"hidden",position:"absolute",zIndex:"-1"}).on("mousedown focusin",function(e){e.stopPropagation()}).prop("tabindex",t.target.prop("tabindex")+1).on("focusin.selectioner",function(){t.display.element.focus()}),this.update(),this.selectioner.target.on("change",function(e,t){t&&"selectioner"===t.source||i.isShown()&&(i.update(),i.reposition())}),e("body").append(this.element)},n.prototype.addDialog=function(t){if(!(t instanceof i.Core.Dialog)){var n=new i.Core.Dialog,o=e(t);n.render=function(){this.element=o},t=n}t.initialize(this.selectioner),t.setPopup(this),t.render(),this.element.append(t.element),this.dialogs.push(t);var s=this.dialogs.length-1,r=this;t.element.on("mousemove",function(){r.dialogFocusIndex(s)})},n.prototype.update=function(){for(var e=0,t=this.dialogs.length;t>e;e++)this.dialogs[e].update()},n.prototype.reposition=function(){var t=this.selectioner.display.element,i=t.offset(),n=this.element.outerWidth(!1)-this.element.width(),o=t.outerWidth(!1)-n,s=t.outerHeight(!1)+i.top,r=e(window).scrollTop(),l=this.element.outerHeight(!0);this.element.removeClass("below").removeClass("above").removeClass("over"),s+l>e(window).height()+r?(s=i.top-l+1,r>s?(s=r,this.element.addClass("over")):this.element.addClass("above")):this.element.addClass("below"),this.element.css({width:o+"px",left:i.left+"px",top:s+"px"})},n.prototype.show=function(){if(!this.selectioner.display.isDisabled()&&!this.selectioner.display.isReadOnly()&&!this.isShown()){var t=this;e(window).one("resize.selectioner_"+this.selectioner.id,function(){t.hide()}),this._isVisible=!0,this.update();var i=this.element.height();this.reposition(),this.element.css({visibility:"visible",zIndex:""}),i!=this.element.height()&&this.reposition(),this.selectioner.target.parents().add(window).on("scroll.selectioner_"+this.selectioner.id,function(){t.isShown()&&t.hide()}),this.selectioner.trigger("show.selectioner")}},n.prototype.hide=function(){e(window).off("resize.selectioner_{id} scroll.selectioner_{id}".replace(/\{id\}/g,this.selectioner.id)),this.isShown()&&(this._isVisible=!1,this.element.css({visibility:"hidden",zIndex:"-1",top:0,left:0}),this.selectioner.trigger("hide.selectioner"),this._dialogFocusIndex=null)},n.prototype.changeDialogFocus=function(e){var t=null;return t=e?this._dialogFocusIndex>0?this.dialogFocusIndex(this._dialogFocusIndex-1):this.dialogFocusIndex(this.dialogs.length-1):this._dialogFocusIndex<this.dialogs.length-1&&null!==this._dialogFocusIndex?this.dialogFocusIndex(this._dialogFocusIndex+1):this.dialogFocusIndex(0)},n.prototype.dialogFocusIndex=function(e){return void 0!==e&&null!==e&&this._dialogFocusIndex!==e&&(null!==this._dialogFocusIndex&&this.dialogs[this._dialogFocusIndex].lostFocus(),this._dialogFocusIndex=e),this._dialogFocusIndex},n.prototype.isShown=function(){return this._isVisible},n.prototype.keyDown=function(e){var t={preventDefault:!1},i=38==e||37==e||8==e,n=this.dialogFocusIndex();null===n&&(n=this.changeDialogFocus(i));for(var o={};!o[n];)o[n]=!0,t=this.dialogs[n].keyDown(e),t.handled||(n=this.changeDialogFocus(i));return t},n.prototype.keyPress=function(e){var t={preventDefault:!1},i=this.element.hasClass("above"),n=this.dialogFocusIndex();null===n&&(n=this.changeDialogFocus(i));for(var o={};!o[n];)o[n]=!0,t=this.dialogs[n].keyPress(e),t.handled||(n=this.changeDialogFocus(i));return t};var o=i.Core.Display=function(){};o.prototype.initialize=function(e){this.selectioner=e,this.validateTarget(),this.createDisplay(),this.createPopup()},o.prototype.isReadOnly=function(){return!1},o.prototype.isDisabled=function(){return this.selectioner.target.is("[disabled]")},o.prototype.createDisplay=function(){var t=this;this.render(),this.update(),this.element.addClass(this.selectioner.settings.cssPrefix+"display"),this.selectioner.target.closest("form").on("reset",function(){setTimeout(function(){t.update()},1)}),this.selectioner.target.on("change.selectioner",function(){t.update()});var i=this.selectioner.target.attr("id");void 0!==i&&(this.labels=e(document).on("click.selectioner",'label[for="'+i+'"]',function(){t.element.focus()})),this.element.on("keydown.selectioner",function(e){var i=e.which;if(e.target==t.element[0])if(t.popup.isShown())t.popup.keyDown(i).preventDefault&&e.preventDefault();else switch(i){case 38:case 40:case 13:e.preventDefault(),t.popup.show()}else 27===i&&t.element.focus()}),this.element.on("keypress.selectioner",function(e){var i=e.which;e.target==t.element[0]&&t.popup.isShown()&&t.popup.keyPress(i).preventDefault&&e.preventDefault()})},o.prototype.createPopup=function(){var t=this,i=this.popup=new n;i.initialize(this.selectioner);var o=this.selectioner.display.element;this.element.on("focusin.selectioner",function(n){var o=e(n.target);n.target===t.element||o.prop("tabindex")>-1?i.show():t.element.focus()}).children().andSelf().on("mousedown.selectioner",function(e){e.stopPropagation(),i.isShown()?i.hide():i.show()}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!i.isShown()||t.target===o[0]||e.contains(o[0],t.target)||t.target===i.element[0]||e.contains(i.element[0],t.target)||i.hide()});var s=this.selectioner.settings.cssPrefix+"visible";this.selectioner.on("show.selectioner",function(){o.addClass(s)}).on("hide.selectioner",function(){o.removeClass(s)})},o.prototype.addDialog=function(e){this.popup.addDialog(e)},o.prototype.render=function(){throw Error('The render method needs to be explicity overridden, and must set "this.element" to a jQuery object.')},o.prototype.update=function(){},o.prototype.remove=function(){this.selectioner.target.off(".selectioner"),this.element.add(this.popup.element).remove()},o.prototype.getNoSelectionText=function(){var e=this.selectioner.target.data("placeholder");return e||(e=this.selectioner.settings.noSelectionText),e};var s=i.Core.Dialog=function(){};s.prototype.initialize=function(e){this.selectioner=e,this.validateTarget()},s.prototype.render=function(){throw Error('The render method needs to be explicity overridden, and must set "this.element" to a jQuery object.')},s.prototype.setPopup=function(e){this.popup=e},s.prototype.update=function(){},s.prototype.validateTarget=function(){},s.prototype.keyDown=function(e){var t={preventDefault:!1,handled:!1};return 27==e&&(this.popup.hide(),t.preventDefault=!0,t.handled=!0),t},s.prototype.keyPress=function(){var e={preventDefault:!1,handled:!1};return e},s.prototype.lostFocus=function(){};var r=i.Display.ListBox=function(){};r.prototype=new i.Core.Display,r.prototype.validateTarget=function(){if(!this.selectioner.target.is("select"))throw Error("ListBox expects it's underlying target element to to be a <select /> element")},r.prototype.render=function(){this.element=e("<span />"),this.textElement=e("<span />").addClass(this.selectioner.settings.cssPrefix+"text");var t=e("<span />").addClass(this.selectioner.settings.cssPrefix+"button");this.element.append(t).append(this.textElement)},r.prototype.update=function(){var e=this.selectioner.target.find("option:selected");if(this.textElement.removeClass("none"),0===e.length||e.is('option[value=""], option:empty:not([value])')){var t=this.getNoSelectionText();t?this.textElement.text(t):this.textElement.html("&nbsp;"),this.textElement.addClass("none")}else if(2>=e.length){for(var i="",n=0,o=e.length;o>n;n++)i+=e[n].text,o-1>n&&(i+=", ");this.textElement.text(i)}else this.textElement.text("Selected "+e.length+" of "+this.selectioner.target.find("option").length)};var l=i.Display.ComboBox=function(){};l.prototype=new i.Core.Display,l.prototype.validateTarget=function(){if(!this.selectioner.target.is("select:not([multiple])"))throw Error('ComboBox expects it\'s underlying target element to to be a <select /> element without a "multiple" attribute')},l.prototype.render=function(){if(this.textElement=this.selectioner.target.next(),!this.textElement.is('input[type="text"]'))throw Error('ComboBox expects the element to follow it\'s target <select /> to be an <input type="text" />');var t=this.getNoSelectionText();null!==t&&this.textElement.attr("placeholder",this.getNoSelectionText()),this.textElement.attr("autocomplete","off");var i=this.getEmptyOptions();if(0===i.length)throw Error("ComboBox elements require an empty and value-less <option></option> in their underlying <select /> elements.");this.element=e("<span />");var n=this;this.textElement.addClass(this.selectioner.settings.cssPrefix+"text").on("change.selectioner",function(e,t){t&&"selectioner"==t.source||n.textChanged()});var o=e("<span />").addClass(this.selectioner.settings.cssPrefix+"button");this.selectioner.on("show.selectioner",function(){n.element.one("focusin.selectioner",function(){n.textElement.select()})}),this.element.append(o).append(this.textElement)},l.prototype.textChanged=function(){var t=this.textElement.val().toUpperCase(),i=this.selectioner.target.find("option").filter(function(){return e(this).text().toUpperCase()==t});1!=i.length&&(i=this.getEmptyOptions()),i[0].selected||(i[0].selected=!0,this.selectioner.target.trigger("change",{source:"selectioner"}))},l.prototype.update=function(){var e=this.selectioner.target.find("option:selected");this.textElement.removeClass("none");var t=e.text();0===e.length?this.textElement.addClass("none"):""!==t&&this.textElement.val(t).trigger("change",{source:"selectioner"})},l.prototype.getEmptyOptions=function(){return this.selectioner.target.find('option[value=""], option:empty:not([value])')},l.prototype.remove=function(){this.selectioner.target.after(this.textElement),i.Core.Display.prototype.remove.call(this)},o.prototype.getNoSelectionText=function(){var e=this.selectioner.target.data("placeholder");return e||(e=this.textElement.attr("placeholder")),e||(e=this.selectioner.settings.noSelectionText),e};var a=i.Display.DateBox=function(){};a.prototype=new i.Core.Display,a.prototype.validateTarget=function(){if(!this.selectioner.target.is('input[type="date"]'))throw Error('DateBox expects it\'s underlying target element to to be a <input type="date" /> element')},a.prototype.isReadOnly=function(){return this.selectioner.target.is("[readonly]")},a.prototype.render=function(){this.element=e("<span />"),this.textElement=e("<span />").addClass(this.selectioner.settings.cssPrefix+"text");var t=e("<span />").addClass(this.selectioner.settings.cssPrefix+"button");this.element.append(t).append(this.textElement)},a.prototype.update=function(){var e=this.selectioner.target.val();if(""!==e){var t=e.match(/(\d+)/g),i=new Date(t[0],t[1]-1,t[2]),n=this.getDateText(i);this.textElement.removeClass("none").text(n)}else this.textElement.addClass("none").text(this.selectioner.target.attr("placeholder")||"Select a date")},a.prototype.getDateText=function(e){return window.Globalize?Globalize.format(e,"d"):e.toLocaleDateString()};var h=i.Dialog.SingleSelect=function(){};h.prototype=new i.Core.Dialog,h.prototype.validateTarget=function(){if(!this.selectioner.target.is("select:not([multiple])"))throw Error('SingleSelect expects it\'s underlying target element to to be a <select /> element without a "multiple" attribute')},h.prototype.render=function(){this.element=e("<ul />");var t=this,i=this.element.on("mousemove","li",function(){var n=e(this);!n.hasClass("highlight")&&t.getSelectableOptions().filter(this).length>0&&(i.find("li").removeClass("highlight"),n.addClass("highlight"))})},h.prototype.update=function(){this.element.empty();var t=this.selectioner.target.children();if(t.length>0)for(var i=0,n=t.length;n>i;i++){var o=e(t[i]);"OPTION"==t[i].tagName?this.element.append(this.renderOption(o)):"OPTGROUP"==t[i].tagName&&this.element.append(this.renderGroup(o))}else this.element.append(e("<li />").addClass("none").append(e("<span />").text(this.selectioner.settings.noOptionText)))},h.prototype.renderOption=function(t){var i,n=this,o=t.text();i=t.is(":disabled")?e("<span />").addClass("disabled").text(o||this.selectioner.settings.emptyOptionText):e("<a />").attr("href","javascript:;").on("click",function(){n.selectOption(t)}).text(o||this.selectioner.settings.emptyOptionText);var s=e("<li />"),r=t.val();return(null===r||""===r)&&s.addClass("none"),s.append(i)},h.prototype.selectOption=function(e){e[0].selected=!0,this.popup.hide(),this.selectioner.target.trigger("change",{source:"selectioner"})},h.prototype.renderGroup=function(t){for(var i=e("<span />").text(t.attr("label")),n=e("<li />").addClass(this.selectioner.settings.cssPrefix+"group-title").append(i),o=t.children(),s=0,r=o.length;r>s;s++){var l=e(o[s]);n=n.add(this.renderOption(l))}var a=e("<li />").append(e("<ul >").append(n));return a},h.prototype.getSelectableOptions=function(){return this.element.find("li").filter(function(){return e(this).children("a,input,label").filter(":not(.disabled,[disabled])").length>0})},h.prototype.highlightAdjacentOption=function(t){var i=this.getSelectableOptions();if(0===i.filter(".highlight").length)return(t?i.first():i.last()).addClass("highlight"),!0;for(var n=0,o=i.length;o>n;n++){var s,r=e(i[n]);if(r.hasClass("highlight")){if(t){if(o-1>n)return r.removeClass("highlight"),s=e(i[n+1]).addClass("highlight"),this.scrollToHighlightedOption(),!0}else if(n>0)return r.removeClass("highlight"),s=e(i[n-1]).addClass("highlight"),this.scrollToHighlightedOption(),!0;return i.removeClass("highlight"),!1}}},h.prototype.scrollToHighlightedOption=function(){var e=this.getSelectableOptions().filter(".highlight");if(e.length>0){var t=e.position().top;if(0>t)this.popup.element.scrollTop(this.popup.element.scrollTop()+t);else{var i=this.popup.element.height();t+=e.height(),t>i&&this.popup.element.scrollTop(this.popup.element.scrollTop()+t-i)}}},h.prototype.selectHighlightedOption=function(){this.getSelectableOptions().filter(".highlight").find("a,label").trigger("click")},h.prototype.clearSelection=function(){this.getSelectableOptions().filter(".none:first").find("a,label").trigger("click")},h.prototype.keyDown=function(e){var t=s.prototype.keyDown.call(this,e);if(!t.handled)switch(e){case 38:this.highlightAdjacentOption(!1)&&(t.handled=!0,t.preventDefault=!0);break;case 40:this.highlightAdjacentOption(!0)&&(t.handled=!0,t.preventDefault=!0);break;case 8:this.clearSelection(),this.popup.hide(),t.handled=!0,t.preventDefault=!0;break;case 32:this.keyPressFilter||(this.selectHighlightedOption(),t.handled=!0,t.preventDefault=!0);break;case 13:this.selectHighlightedOption(),t.handled=!0,t.preventDefault=!0}return this.scrollToHighlightedOption(),t},h.prototype.keyPress=function(t){var i={preventDefault:!1,handled:!1};if(13!=t&&9!=t){var n=this;clearTimeout(this.keyPressFilterTimeout),this.keyPressFilter=(this.keyPressFilter||"")+String.fromCharCode(t).toUpperCase(),this.keyPressFilterTimeout=setTimeout(function(){n.keyPressFilter=""},400);for(var o=this.getSelectableOptions(),s=!1,r=0,l=o.length;l>r;r++){var a=e(o[r]);if(a.text().toUpperCase().indexOf(this.keyPressFilter)>-1){o.removeClass("highlight"),a.addClass("highlight"),s=!0;break}}s||(clearTimeout(this.keyPressFilterTimeout),this.keyPressFilter=""),i.preventDefault=!0,i.handled=!0}return i},h.prototype.lostFocus=function(){this.element.find("li").removeClass("highlight")};var p=i.Dialog.MultiSelect=function(){};p._inputIdIndex=0,p.prototype=new i.Dialog.SingleSelect,p.prototype.validateTarget=function(){if(!this.selectioner.target.is("select[multiple]"))throw Error('MultiSelect expects it\'s underlying target element to to be a <select /> element with a "multiple" attribute')},p.prototype.renderOption=function(t){var i=e("<li />"),n="MultiSelectCheckbox"+p._inputIdIndex++,o=e('<input type="checkbox" />').data("option",t).attr("id",n);t[0].selected&&o.attr("checked","checked");var s=e("<label />").append(o).append(e("<span />").text(t.text())).attr("for",n),r=this.selectioner;return o.on("change.selectioner",function(){t[0].selected=this.checked,r.target.trigger("change",{source:"selectioner"})}),t.is(":disabled")&&(s.addClass("disabled"),o.prop("disabled",!0)),i.append(s),i},p.prototype.renderGroup=function(t){for(var i=this,n=function(){var t=e(this).closest("ul").find("input:checkbox:not(:disabled)"),n=t.filter(":checked").length;t.prop("checked",n!=t.length||0===n).each(function(){e(this).data("option")[0].selected=this.checked}),i.selectioner.target.trigger("change",{source:"selectioner"})},o=e("<a />").attr("href","javascript:;").on("click",n).text(t.attr("label")),s=e("<li />").addClass(this.selectioner.settings.cssPrefix+"group-title").append(o),r=t.children(),l=0,a=r.length;a>l;l++){var h=e(r[l]);s=s.add(this.renderOption(h))}var p=e("<li />").append(e("<ul >").append(s));return p},p.prototype.clearSelection=function(){this.getSelectableOptions().find("input:checkbox:checked").trigger("click")};var c=i.Dialog.ComboSelect=function(){};c.prototype=new i.Dialog.SingleSelect,c.prototype.validateTarget=function(){if(!this.selectioner.target.is("select:not([multiple])"))throw Error('ComboSelect expects it\'s underlying target element to to be a <select /> element without a "multiple" attribute')},c.prototype.renderOption=function(e){return e.is('option[value=""], option:empty:not([value])')?null:i.Dialog.SingleSelect.prototype.renderOption.call(this,e)};var d=i.Dialog.AutoComplete=function(){};d.prototype=new i.Dialog.SingleSelect,d.prototype.validateTarget=function(){if(!this.selectioner.target.is("select:not([multiple])"))throw Error('ComboSelect expects it\'s underlying target element to to be a <select /> element without a "multiple" attribute')},d.prototype.render=function(){if(h.prototype.render.apply(this,arguments),this.textElement=this.selectioner.display.element.find('input[type="text"]'),0===this.textElement.length)throw Error('AutoComplete expects the Display to contain an <input type="text" /> element');this.update();var e=this;this.textElement.on("keyup click",function(t,i){i&&"selectioner"==i.source||(e.update(),e.popup.isShown()?e.popup.reposition():e.popup.show())}),this.update()},d.prototype.update=function(){for(var t=this,i=function(i){var n=e("<a />").attr("href","javascript:;").text(i.text()).on("click",function(){i[0].selected=!0,t.popup.hide(),t.selectioner.target.trigger("change",{source:"selectioner"})});return e("<li />").append(n)},n=this.textElement.val().toLowerCase(),o=this.selectioner.target.find("option"),s=e(),r=0,l=o.length;l>r;r++){var a=e(o[r]),h=a.text().toLowerCase();if(""!==h&&0===h.indexOf(n)&&(s=s.add(i(a)),s.length>this.selectioner.settings.maxAutoCompleteItems))break}0===s.length&&(s=e("<li />").addClass("none").append(e("<span />").text(this.selectioner.settings.noOptionText))),this.element.empty().append(s)};var u=i.Dialog.DateSelect=function(){};u.prototype=new i.Core.Dialog,u.Settings={monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],weekStartIndex:1},u.Utility={isLeapYear:function(e){return 0===e%4&&0!==e%100||0===e%400},daysInMonth:function(e,t){return[31,u.Utility.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},dateToString:function(e){if(!e)return null;var t=""+e.getDate(),i=""+(e.getMonth()+1),n=""+e.getFullYear();return 1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),n+"-"+i+"-"+t},stringToTitleCase:function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},buildScroller:function(t,i){var n=function(n){var o=e("<a />").attr("href","javascript:;").append(e("<span />").text(t[n]));return i===t[n]&&o.addClass("current"),o};return e("<span />").addClass("scroller").append(e("<a />").attr("href","javascript:;").addClass("up")).append(n(0).addClass("previous")).append(n(1).addClass("selected")).append(n(2).addClass("next")).append(e("<a />").attr("href","javascript:;").addClass("down"))}},u.prototype.validateTarget=function(){if(!this.selectioner.target.is('input[type="date"]'))throw Error('DateBox expects it\'s underlying target element to to be a <input type="date" /> element')},u.prototype.render=function(){var t=this,i=function(e){e.preventDefault();var t=0;return t=e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:-1*e.originalEvent.deltaY,0>t?1:-1};this.element=e("<div />").on("mousewheel wheel",function(e){e.preventDefault()}).addClass(this.selectioner.settings.cssPrefix+"date").on("mousewheel wheel",".days",function(e){t.addDays(i(e))}).on("mousewheel wheel",".months",function(e){t.addMonths(i(e))}).on("mousewheel wheel",".years",function(e){t.addYears(i(e))}).on("click",".days .previous, .days .up",function(){t.addDays(-1)}).on("click",".days .next, .days .down",function(){t.addDays(1)}).on("click",".months .previous, .months .up",function(){t.addMonths(-1)}).on("click",".months .next, .months .down",function(){t.addMonths(1)}).on("click",".years .previous, .years .up",function(){t.addYears(-1)}).on("click",".years .next, .years .down",function(){t.addYears(1)}).on("click",".selected",function(){t.setCurrentDate(t.getCurrentDate()),t.popup.hide()}).on("click",".today",function(){t.setCurrentDate(new Date),t.popup.hide()}).on("click",".clear",function(){t.setCurrentDate(null),t.popup.hide()}),this.update()},u.prototype.update=function(){var t=this.getCurrentDate(),i=t.getFullYear(),n=u.Settings.monthNames;window.Globalize&&(n=Globalize.culture().calendars.standard.months.namesAbbr);var o=t.getMonth(),s=0===o?11:o-1,r=11===o?0:o+1,l=[u.Utility.stringToTitleCase(n[s]),u.Utility.stringToTitleCase(n[o]),u.Utility.stringToTitleCase(n[r])],a=t.getDate(),h=new Date(t);h.setDate(a-1);var p=[1===a?h.getDate():a-1,a,a===u.Utility.daysInMonth(i,o)?1:a+1],c=new Date,d=e("<a />").attr("href","javascript:;").addClass("today").append(e("<span />").text("Today")),g=e("<a />").attr("href","javascript:;").addClass("clear").append(e("<span />").text("Clear"));this.element.empty().append(d);var f=new Date(1999,7,4),m=f.toLocaleDateString();window.Globalize&&(m=Globalize.format(f,"d"));var y=m.indexOf("8");-1===y&&(y=m.search(/[^\d ]/i));var v=[{index:m.indexOf("99"),element:u.Utility.buildScroller([i-1,i,i+1],c.getFullYear()).addClass("years")},{index:y,element:u.Utility.buildScroller(l,n[c.getMonth()]).addClass("months")},{index:m.indexOf("4"),element:u.Utility.buildScroller(p,c.getDate()).addClass("days")}];v.sort(function(e,t){return e.index>t.index});for(var x=0;3>x;x++)this.element.append(v[x].element);this.element.append(g)},u.prototype.addDays=function(e){if(e){var t=this.getCurrentDate();t.setDate(t.getDate()+e),this.setCurrentDate(t)}},u.prototype.addMonths=function(e){if(e){var t=this.getCurrentDate();t.setMonth(t.getMonth()+e),this.setCurrentDate(t)}},u.prototype.addYears=function(e){if(e){var t=this.getCurrentDate();t.setYear(t.getFullYear()+e),this.setCurrentDate(t)}},u.prototype.getCurrentDate=function(){var e=this.selectioner.target.val();if(""!==e){var t=e.match(/(\d+)/g);return new Date(t[0],t[1]-1,t[2])}return new Date},u.prototype.setCurrentDate=function(e){this.selectioner.target.val(u.Utility.dateToString(e)).trigger("change.selectioner"),this.update()},u.prototype.keyDown=function(e){var t=s.prototype.keyDown.call(this,e);if(!t.handled)switch(e){case 38:this.addDays(-1),t.handled=!0,t.preventDefault=!0;break;case 40:this.addDays(1),t.handled=!0,t.preventDefault=!0;break;case 8:this.setCurrentDate(null),this.popup.hide(),t.handled=!0,t.preventDefault=!0;break;case 32:case 13:this.setCurrentDate(this.getCurrentDate()),this.popup.hide(),t.handled=!0,t.preventDefault=!0}return t},e.fn.singleSelect=function(){return this.each(function(){new i(this,new i.Display.ListBox,new i.Dialog.SingleSelect)}),this},e.fn.multiSelect=function(){return this.each(function(){new i(this,new i.Display.ListBox,new i.Dialog.MultiSelect)}),this},e.fn.comboSelect=function(e){return this.each(function(){new i(this,new i.Display.ComboBox(e),new i.Dialog.ComboSelect)}),this},e.fn.autoComplete=function(){return this.each(function(){new i(this,new i.Display.ComboBox,new i.Dialog.AutoComplete)}),this},e.fn.dateSelect=function(){return this.each(function(){new i(this,new i.Display.DateBox,new i.Dialog.DateSelect)}),this}})(jQuery);