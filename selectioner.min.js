(function(e){var t=function(){};t.prototype.initialize=function(t,n){this.select=t,this.display=n,this.element=e("<div />").addClass("select-dialog").css({display:"none",position:"absolute"}),this.options=e("<ul />"),this.element.append(this.options),this.refreshOptions();var i=this;this.display.element.on("focusin.select",function(){i.show(),n.element.on("mousedown.hide-select",function(){i.isShown()?i.hide():i.show()})}),e(document).on("mousedown.select focusin.select",function(t){!i.isShown()||t.target===i.display.element[0]||e.contains(i.display.element[0],t.target)||t.target===i.element[0]||e.contains(i.element[0],t.target)||(n.element.off("mousedown.hide-select"),i.hide())}),e("body").append(this.element)},t.prototype.refreshPosition=function(){var e=this.display.element.offset(),t=this.element.outerWidth(!1)-this.element.width();this.element.css({width:this.display.element.outerWidth(!1)-t+"px",left:e.left+"px",top:this.display.element.outerHeight(!1)+e.top+"px"})},t.prototype.refreshOptions=function(){this.options.empty();for(var t=this.select.children(),n=0,i=t.length;i>n;n++){var s=e(t[n]);"OPTION"===t[n].tagName?this.options.append(this.renderOption(s)):"OPTGROUP"===t[n].tagName&&this.options.append(this.renderOptionGroup(s))}},t.prototype.renderOption=function(t){var n=this,i=function(){t[0].selected=!0,n.select.trigger("change"),n.hide()},s=e("<a />").attr("href","javascript:;").on("click",i).text(t.text());return e("<li />").append(s)},t.prototype.renderOptionGroup=function(t){for(var n=e("<span />").text(t.attr("label")),i=e("<li />").addClass("title").append(n),s=t.children(),o=0,l=s.length;l>o;o++){var r=e(s[o]);i=i.add(this.renderOption(r))}return e("<li />").append(e("<ul >").append(i))},t.prototype.show=function(){this.refreshOptions(),this.refreshPosition(),this.element.css("display",""),this.select.trigger("show-dialog.select")},t.prototype.hide=function(){this.element.css("display","none"),this.select.trigger("hide-dialog.select")},t.prototype.isShown=function(){return this.element.is(":visible")};var n=0,i=function(){};i.prototype=new t,i.prototype.renderOption=function(t){var i=e("<li />"),s="MultiSelectCheckbox"+n++,o=e('<input type="checkbox" />').attr("id",s);t[0].selected&&o.attr("checked","checked");var l=e("<label />").text(t.text()).attr("for",s),r=this;return o.on("change.select",function(){t[0].selected=this.checked,r.select.trigger("change")}),i.append(o).append(l),i},i.prototype.renderOptionGroup=function(t){for(var n=function(){var t=e(this).closest("ul").find("input:checkbox"),n=t.filter(":checked").length;n>0&&t.length===n?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.select")},i=e("<a />").attr("href","javascript:;").on("click",n).text(t.attr("label")),s=e("<li />").addClass("select-group-title").append(i),o=t.children(),l=0,r=o.length;r>l;l++){var a=e(o[l]);s=s.add(this.renderOption(a))}return e("<li />").append(e("<ul >").append(s))};var s=function(){};s.prototype.initialize=function(e){this.select=e,this.render(),this.select.css("display","none").after(this.element);var t=this;this.select.on("change.select",function(){t.update()}).on("show-dialog.select",function(){t.element.addClass("select-visible")}).on("hide-dialog.select",function(){t.element.removeClass("select-visible")})},s.prototype.render=function(){this.element=e("<span />").prop("tabindex",this.select.prop("tabindex")).addClass("select-display"),this.textElement=e("<span />").addClass("select-text"),this.button=e("<span />").addClass("select-button"),this.element.append(this.button).append(this.textElement),this.update()},s.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None"),this.textElement.addClass("none");else if(2>=e.length){for(var t="",n=0,i=e.length;i>n;n++)t+=e[n].innerText,i-1>n&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)},e.fn.select=function(){this.filter("select").each(function(){var n=e(this),i=new s;i.initialize(n);var o=new t;o.initialize(n,i)})},e.fn.multiselect=function(){this.filter("select").each(function(){var t=e(this),n=new s;n.initialize(t);var o=new i;o.initialize(t,n)})}})(jQuery);