(function(e){"use strict";window.Selectioner={Base:{},Dialog:{},Display:{},Extensions:{},Popup:{},Settings:{}},Selectioner.Settings={cssPrefix:"select-",noSelectionText:"Select an option",emptyOptionText:"None",maxAutoCompleteItems:5};var t=Selectioner.Base.Eventable=function(){};t.prototype.on=function(e,t,n){var i=e.split(" ");return i.length>1?i.forEach(function(e){this.on(e,t,n)},this):(this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push({handler:t,context:n?n:this})),this},t.prototype.off=function(e,t){if(!this._eventHandlers)return this;var n=function(e,t){for(var n=0,i=this._eventHandlers[e].length;i>n;n++)this._eventHandlers[e][n].handler==t&&this._eventHandlers[e].splice(n,1)};if(e)if(e&&!t)if("function"!=typeof e){if(!this._eventHandlers[e])return this;this._eventHandlers[e].length=0}else{var i=e;for(var o in this._eventHandlers)n.call(this,o,i)}else{if(!this._eventHandlers[e])return this;n.call(this,e,t)}else delete this._eventHandlers;return this},t.prototype.trigger=function(e,t){if(this._eventHandlers){var n=this._eventHandlers[e];if(n)for(var i=this,o=0,s=n.length;s>o;o++){var l=n[o];l.handler.call(l.context,{target:i,name:e,data:t})}return this}};var n=Selectioner.Base.Popup=function(){};n.prototype=new t,n.prototype.initialize=function(t){this.display=t,this.dialogs=[],this.element=e("<div />").addClass(Selectioner.Settings.cssPrefix+"popup").css({visibility:"hidden",position:"absolute",zIndex:"-1"}),this.render(),e("body").append(this.element)},n.prototype.addDialog=function(e){e.setPopup(this),this.dialogs.push(e)},n.prototype.render=function(){this.element.empty();for(var e=0,t=this.dialogs.length;t>e;e++){var n=this.dialogs[e];n.render(),this.element.append(n.element)}},n.prototype.reposition=function(){var t=this.display.element.offset(),n=this.element.outerWidth(!1)-this.element.width(),i=this.display.element.outerWidth(!1)-n,o=this.display.element.outerHeight(!1)+t.top,s=e(window).scrollTop(),l=this.element.outerHeight(!0);this.element.removeClass("below").removeClass("above").removeClass("over"),o+l>e(window).height()+s?(o=t.top-l+1,s>o?(o=s,this.element.addClass("over")):this.element.addClass("above")):this.element.addClass("below"),this.element.css({width:i+"px",left:t.left+"px",top:o+"px"})},n.prototype.show=function(){this.isShown()||(this._isVisible=!0,this.render(),this.reposition(),this.element.css({visibility:"visible",zIndex:""}),this.trigger("show.selectioner"))},n.prototype.hide=function(){this.isShown()&&(this._isVisible=!1,this.element.css({visibility:"hidden",zIndex:"-1"}),this.trigger("hide.selectioner"))},n.prototype.isShown=function(){return this._isVisible};var i=Selectioner.Base.Display=function(){};i.prototype=new t,i.prototype.initialize=function(t){this.select=t;var n=Selectioner.Settings.cssPrefix+"display",i=t.next();i.hasClass(n)&&i.remove(),this.render(),this.update(),this.element.addClass(n).prop("tabindex",this.select.prop("tabindex")),this.select.css("display","none").after(this.element);var o=this,s=t.attr("id");void 0!==s&&(this.labels=e(document).on("click.selectioner",'label[for="'+s+'"]',function(){o.element.focus()})),this.select.on("change.selectioner",function(){o.update()});var l=this.popup=new Selectioner.Base.Popup;l.initialize(this),this.element.on("focusin.selectioner",function(){l.show()}).children().andSelf().on("mousedown.selectioner",function(e){e.stopPropagation(),l.isShown()?l.hide():l.show()}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!l.isShown()||t.target===l.display.element[0]||e.contains(l.display.element[0],t.target)||t.target===l.element[0]||e.contains(l.element[0],t.target)||l.hide()}),e(window).on("resize.selectioner",function(){l.hide()}),l.on("show.selectioner",function(){o.element.addClass(Selectioner.Settings.cssPrefix+"visible")}).on("hide.selectioner",function(){o.element.removeClass(Selectioner.Settings.cssPrefix+"visible")})},i.prototype.addDialog=function(e){e.initialize(this.select),this.popup.addDialog(e)},i.prototype.render=function(){throw Error('The render method needs to be explicity overridden, and must set "this.element" to a jQuery object.')},i.prototype.update=function(){};var o=Selectioner.Base.Dialog=function(){};o.prototype=new t,o.prototype.initialize=function(e){this.select=e},o.prototype.render=function(){throw Error('The render method needs to be explicity overridden, and must set "this.element" to a jQuery object.')},o.prototype.setPopup=function(e){this.popup=e};var s=Selectioner.Display.ListBox=function(){};s.prototype=new Selectioner.Base.Display,s.prototype.render=function(){this.element=e("<span />"),this.textElement=e("<span />").addClass(Selectioner.Settings.cssPrefix+"text");var t=e("<span />").addClass(Selectioner.Settings.cssPrefix+"button");this.element.append(t).append(this.textElement)},s.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0===e.length||e.is('option[value=""], option:empty:not([value])')){var t=Selectioner.Settings.noSelectionText;t?this.textElement.text(t):this.textElement.html("&nbsp;"),this.textElement.addClass("none")}else if(2>=e.length){for(var n="",i=0,o=e.length;o>i;i++)n+=e[i].text,o-1>i&&(n+=", ");this.textElement.text(n)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)};var l=Selectioner.Display.ComboBox=function(t){this.textElement=e(t),this.textElement.is("[placeholder]")||this.textElement.attr("placeholder",Selectioner.Settings.noSelectionText)};l.prototype=new Selectioner.Base.Display,l.prototype.render=function(){var t=this.getEmptyOptions();if(0===t.length)throw Error("ComboBox elements require an empty and value-less <option></option> in their underlying <select /> elements.");this.element=e("<span />");var n=this;this.textElement.addClass(Selectioner.Settings.cssPrefix+"text").on("change.selectioner",function(){n.textChanged()});var i=e("<span />").addClass(Selectioner.Settings.cssPrefix+"button");this.element.append(i).append(this.textElement)},l.prototype.textChanged=function(){var t=this.textElement.val().toUpperCase(),n=this.select.find("option").filter(function(){return e(this).text().toUpperCase()==t});1!=n.length&&(n=this.getEmptyOptions()),n[0].selected=!0,this.select.trigger("change")},l.prototype.update=function(){var e=this.select.find("option:selected");this.textElement.removeClass("none");var t=e.text();0===e.length?this.textElement.addClass("none"):""!==t&&this.textElement.val(t)},l.prototype.getEmptyOptions=function(){return this.select.find('option[value=""], option:empty:not([value])')};var r=Selectioner.Dialog.SingleSelect=function(){};r.prototype=new Selectioner.Base.Dialog,r.prototype.render=function(){this.element=e("<ul />");for(var t=this.select.children(),n=0,i=t.length;i>n;n++){var o=e(t[n]);"OPTION"==t[n].tagName?this.element.append(this.renderOption(o)):"OPTGROUP"==t[n].tagName&&this.element.append(this.renderGroup(o))}},r.prototype.renderOption=function(t){var n=this,i=this.select,o=function(){t[0].selected=!0,n.popup.hide(),i.trigger("change")},s=t.text(),l=e("<a />").attr("href","javascript:;").on("click",o).text(s||Selectioner.Settings.emptyOptionText),r=e("<li />");return s||r.addClass("none"),r.append(l)},r.prototype.renderGroup=function(t){for(var n=e("<span />").text(t.attr("label")),i=e("<li />").addClass(Selectioner.Settings.cssPrefix+"group-title").append(n),o=t.children(),s=0,l=o.length;l>s;s++){var r=e(o[s]);i=i.add(this.renderOption(r))}var a=e("<li />").append(e("<ul >").append(i));return a};var a=Selectioner.Dialog.MultiSelect=function(){};a._inputIdIndex=0,a.prototype=new Selectioner.Dialog.SingleSelect,a.prototype.renderOption=function(t){var n=e("<li />"),i="MultiSelectCheckbox"+a._inputIdIndex++,o=e('<input type="checkbox" />').attr("id",i);t[0].selected&&o.attr("checked","checked");var s=e("<label />").append(o).append(e("<span />").text(t.text())).attr("for",i),l=this;return o.on("change.selectioner",function(){t[0].selected=this.checked,l.select.trigger("change")}),n.append(s),n},a.prototype.renderGroup=function(t){for(var n=function(){var t=e(this).closest("ul").find("input:checkbox"),n=t.filter(":checked").length;n>0&&t.length===n?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.selectioner")},i=e("<a />").attr("href","javascript:;").on("click",n).text(t.attr("label")),o=e("<li />").addClass(Selectioner.Settings.cssPrefix+"group-title").append(i),s=t.children(),l=0,r=s.length;r>l;l++){var a=e(s[l]);o=o.add(this.renderOption(a))}var p=e("<li />").append(e("<ul >").append(o));return p};var p=Selectioner.Dialog.ComboSelect=function(){};p.prototype=new Selectioner.Dialog.SingleSelect,p.prototype.renderOption=function(e){return e.is('option[value=""], option:empty:not([value])')?null:Selectioner.Dialog.SingleSelect.prototype.renderOption.call(this,e)};var c=Selectioner.Dialog.AutoComplete=function(t){var n=this;this.textElement=e(t),this.textElement.on("keyup",function(){n.update(),n.popup.isShown()?n.popup.reposition():n.popup.show()})};c.prototype=new Selectioner.Base.Dialog,c.prototype.render=function(){this.element=e("<ul />"),this.update();for(var t=this,n=this.select,i=this.select.find("option"),o=function(i){var o=e("<a />").attr("href","javascript:;").text(i.text()).on("click",function(){i[0].selected=!0,t.popup.hide(),n.trigger("change")});return e("<li />").append(o)},s=0,l=i.length;l>s;s++){var r=e(i[s]);this.element.append(o(r))}this.update()},c.prototype.update=function(){var t=this.textElement.val().toLowerCase(),n=this.element.find("li"),i=n.filter(function(){var n=e(this).text().toLowerCase();return""!==n&&0===n.indexOf(t)}).filter(function(e){return Selectioner.Settings.maxAutoCompleteItems>e});n.not(i).css("display","none"),i.css("display","")},e.fn.singleSelect=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this)),t.addDialog(new Selectioner.Dialog.SingleSelect)})},e.fn.multiSelect=function(){this.filter("select[multiple]").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this)),t.addDialog(new Selectioner.Dialog.MultiSelect)})},e.fn.comboSelect=function(t){this.filter("select:not([multiple])").each(function(){var n=new Selectioner.Display.ComboBox(t);n.initialize(e(this)),n.addDialog(new Selectioner.Dialog.ComboSelect)})},e.fn.autoComplete=function(t){this.filter("select:not([multiple])").each(function(){var n=new Selectioner.Display.ComboBox(t);n.initialize(e(this)),n.addDialog(new Selectioner.Dialog.AutoComplete(t))})}})(jQuery);