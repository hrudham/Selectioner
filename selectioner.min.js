(function(e){"use strict";window.Selectioner={Base:{},Dialog:{},Display:{},Extensions:{},Popup:{},Settings:{},Utility:{}};var t=Selectioner.Settings={cssPrefix:"select-"};Selectioner.Utility.copyCss=function(e,t){t.attr("style",e.attr("style"));for(var i=(e.attr("class")||"").split(" "),n=0,s=i.length;s>n;n++)t.addClass(i[n])},Selectioner.Utility.copyData=function(e,t){var i=e.data();for(var n in i)t.attr("data-"+n,i[n])};var i=Selectioner.Base.Eventable=function(){};i.prototype.on=function(e,t,i){var n=e.split(" ");return n.length>1?n.forEach(function(e){this.on(e,t,i)},this):(this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[e]||(this._eventHandlers[e]=[]),this._eventHandlers[e].push({handler:t,context:i?i:this})),this},i.prototype.off=function(e,t){if(!this._eventHandlers)return this;var i=function(e,t){for(var i=0,n=this._eventHandlers[e].length;n>i;i++)this._eventHandlers[e][i].handler==t&&this._eventHandlers[e].splice(i,1)};if(e)if(e&&!t)if("function"!=typeof e){if(!this._eventHandlers[e])return this;this._eventHandlers[e].length=0}else{var n=e;for(var s in this._eventHandlers)i.call(this,s,n)}else{if(!this._eventHandlers[e])return this;i.call(this,e,t)}else delete this._eventHandlers;return this},i.prototype.trigger=function(e,t){if(this._eventHandlers){var i=this._eventHandlers[e];if(i){var n=this;i.forEach(function(i){i.handler.call(i.context,{target:n,name:e,data:t})})}return this}};var n=Selectioner.Base.Popup=function(){};n.prototype=new i,n.prototype.initialize=function(i,n,s){this.select=i,this.display=n,this.dialog=s,this.element=e("<div />").addClass(t.cssPrefix+"popup").css({visibility:"hidden",position:"absolute",zIndex:"-1"}),this.render(),e("body").append(this.element)},n.prototype.reposition=function(){var t=this.display.element.offset(),i=this.element.outerWidth(!1)-this.element.width(),n=this.display.element.outerWidth(!1)-i,s=this.display.element.outerHeight(!1)+t.top,l=e(window).scrollTop(),o=this.element.outerHeight(!0);this.element.removeClass("below").removeClass("above").removeClass("over"),s+o>window.innerHeight+l?(s=t.top-o+1,l>s?(s=l,this.element.addClass("over")):this.element.addClass("above")):this.element.addClass("below"),this.element.css({width:n+"px",left:t.left+"px",top:s+"px"})},n.prototype.render=function(){this.element.empty().append(this.dialog.render())},n.prototype.show=function(){this.render(),this.reposition(),this.element.css({visibility:"visible",zIndex:""}),this.trigger("show.selectioner"),this._isVisible=!0},n.prototype.hide=function(){this.element.css({visibility:"hidden",zIndex:"-1"}),this.trigger("hide.selectioner"),this._isVisible=!1},n.prototype.isShown=function(){return this._isVisible};var s=Selectioner.Base.Display=function(){};s.prototype=new i,s.prototype.initialize=function(i,n){this.select=i,this.render(),this.update(),Selectioner.Utility.copyData(i,this.element),Selectioner.Utility.copyCss(i,this.element),this.select.css("display","none").after(this.element);var s=this,l=i.attr("id");void 0!==l&&(this.labels=e(document).on("click.selectioner",'label[for="'+l+'"]',function(){s.element.focus()})),this.select.on("change.selectioner",function(){s.update()}),n.initialize(i);var o=new Selectioner.Base.Popup;o.initialize(i,this,n),this.element.on("focusin.selectioner",function(){o.show()}).children().on("mousedown.selectioner",function(e){e.stopPropagation(),o.isShown()?o.hide():o.show()}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!o.isShown()||t.target===o.display.element[0]||e.contains(o.display.element[0],t.target)||t.target===o.element[0]||e.contains(o.element[0],t.target)||o.hide()}),e(window).on("resize.selectioner",function(){o.hide()}),o.on("show.selectioner",function(){s.element.addClass(t.cssPrefix+"visible")}).on("hide.selectioner",function(){s.element.removeClass(t.cssPrefix+"visible")})},s.prototype.render=function(){this.element=e("<span />").addClass(t.cssPrefix+"display").prop("tabindex",this.select.prop("tabindex")),this.textElement=e("<span />").addClass(t.cssPrefix+"text");var i=e("<span />").addClass(t.cssPrefix+"button");this.element.append(i).append(this.textElement)},s.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0===e.length)this.textElement.text("None"),this.textElement.addClass("none");else if(2>=e.length){for(var t="",i=0,n=e.length;n>i;i++)t+=e[i].text,n-1>i&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)};var l=Selectioner.Base.Dialog=function(){};l.prototype=new i,l.prototype.initialize=function(e){this.select=e},l.prototype.render=function(){for(var t=e("<ul />"),i=this.select.children(),n=0,s=i.length;s>n;n++){var l=e(i[n]);"OPTION"==i[n].tagName?t.append(this.renderOption(l)):"OPTGROUP"==i[n].tagName&&t.append(this.renderGroup(l))}return t};var o=Selectioner.Display.ListBox=function(){};o.prototype=new Selectioner.Base.Display,o.prototype.render=function(){this.element=e("<span />").addClass(t.cssPrefix+"display").prop("tabindex",this.select.prop("tabindex")),this.textElement=e("<span />").addClass(t.cssPrefix+"text");var i=e("<span />").addClass(t.cssPrefix+"button");this.element.append(i).append(this.textElement)},o.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0===e.length)this.textElement.text("None").addClass("none");else if(2>=e.length){for(var t="",i=0,n=e.length;n>i;i++)t+=e[i].text,n-1>i&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)};var r=Selectioner.Display.ComboBox=function(t){this.textElement=e(t)};r.prototype=new Selectioner.Base.Display,r.prototype.render=function(){this.element=e("<span />").addClass(t.cssPrefix+"display").prop("tabindex",this.select.prop("tabindex")),this.textElement.addClass(t.cssPrefix+"text");var i=e("<span />").addClass(t.cssPrefix+"button").on("focus",function(){});this.element.append(i).append(this.textElement)},r.prototype.update=function(){var e=this.select.find("option:selected");this.textElement.removeClass("none");var t=e.text();0===e.length?this.textElement.addClass("none"):""!==t&&this.textElement.val(t)};var a=Selectioner.Dialog.SingleSelect=function(){};a.prototype=new Selectioner.Base.Dialog,a.prototype.renderOption=function(t){var i=this.select,n=function(){t[0].selected=!0,i.trigger("change.selectioner")},s=e("<a />").attr("href","javascript:;").on("click",n).text(t.text());return Selectioner.Utility.copyData(t,s),Selectioner.Utility.copyCss(t,s),e("<li />").append(s)},a.prototype.renderGroup=function(i){for(var n=e("<span />").text(i.attr("label")),s=e("<li />").addClass(t.cssPrefix+"group-title").append(n),l=i.children(),o=0,r=l.length;r>o;o++){var a=e(l[o]);s=s.add(this.renderOption(a))}var c=e("<li />").append(e("<ul >").append(s));return Selectioner.Utility.copyData(i,c),Selectioner.Utility.copyCss(i,c),c};var c=Selectioner.Dialog.MultiSelect=function(){};c._inputIdIndex=0,c.prototype=new Selectioner.Base.Dialog,c.prototype.renderOption=function(t){var i=e("<li />"),n="MultiSelectCheckbox"+c._inputIdIndex++,s=e('<input type="checkbox" />').attr("id",n);t[0].selected&&s.attr("checked","checked");var l=e("<label />").append(s).append(e("<span />").text(t.text())).attr("for",n),o=this;return s.on("change.selectioner",function(){t[0].selected=this.checked,o.select.trigger("change.selectioner")}),i.append(l),Selectioner.Utility.copyData(t,i),Selectioner.Utility.copyCss(t,i),i},c.prototype.renderGroup=function(i){for(var n=function(){var t=e(this).closest("ul").find("input:checkbox"),i=t.filter(":checked").length;i>0&&t.length===i?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.selectioner")},s=e("<a />").attr("href","javascript:;").on("click",n).text(i.attr("label")),l=e("<li />").addClass(t.cssPrefix+"group-title").append(s),o=i.children(),r=0,a=o.length;a>r;r++){var c=e(o[r]);l=l.add(this.renderOption(c))}var p=e("<li />").append(e("<ul >").append(l));return Selectioner.Utility.copyData(i,p),Selectioner.Utility.copyCss(i,p),p},e.fn.singleSelect=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.SingleSelect)})},e.fn.multiSelect=function(){this.filter("select[multiple]").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.MultiSelect)})},e.fn.comboSelect=function(t){this.filter("select:not([multiple])").each(function(){var i=new Selectioner.Display.ComboBox(t);i.initialize(e(this),new Selectioner.Dialog.SingleSelect)})}})(jQuery);