(function(e){Selectioner={Extensions:{},Dialog:{},Display:{},Popup:{}},function(){var t=Selectioner.Popup.Base=function(){};t.prototype.initialize=function(t,n,i){this.select=t,this.display=n,this.dialog=i,this.element=e("<div />").addClass("select-dialog").css({display:"none",position:"absolute"}),this.render();var i=this,s=function(){i.isShown()?i.hide():i.show()},n=this.display;this.display.element.on("focusin.selectioner",function(){i.show()}).children().on("mousedown",function(e){e.stopPropagation(),s()}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!i.isShown()||t.target===i.display.element[0]||e.contains(i.display.element[0],t.target)||t.target===i.element[0]||e.contains(i.element[0],t.target)||(n.element.off("mousedown.hide-select"),i.hide())}),e("body").append(this.element)},t.prototype.reposition=function(){var e=this.display.element.offset(),t=this.element.outerWidth(!1)-this.element.width();this.element.css({width:this.display.element.outerWidth(!1)-t+"px",left:e.left+"px",top:this.display.element.outerHeight(!1)+e.top+"px"})},t.prototype.render=function(){this.element.empty().append(this.dialog.render())},t.prototype.show=function(){this.render(),this.reposition(),this.element.css("display",""),this.select.trigger("show-dialog.selectioner")},t.prototype.hide=function(){this.element.css("display","none"),this.select.trigger("hide-dialog.selectioner")},t.prototype.isShown=function(){return this.element.is(":visible")}}(),function(){var t=Selectioner.Display.Base=function(){};t.prototype.initialize=function(t,n){this.select=t;var i=t.attr("style"),s=(t.attr("class")||"").split(" "),o=t.data();this.render(),this.update(),this.element.attr("style",i);for(var l=0,a=s.length;a>l;l++)this.element.addClass(s[l]);for(var r in o)this.element.attr("data-"+r,o[r]);var c=this,p=t.attr("id");void 0!==p&&e('label[for="'+p+'"]').on("click",function(){c.element.focus()}),this.select.on("change.selectioner",function(){c.update()}).on("show-dialog.selectioner",function(){c.element.addClass("select-visible")}).on("hide-dialog.selectioner",function(){c.element.removeClass("select-visible")}),n.initialize(t);var d=new Selectioner.Popup.Base;d.initialize(t,this,n)},t.prototype.render=function(){this.element=e("<span />").addClass("select-display").prop("tabindex",this.select.prop("tabindex")),this.textElement=e("<span />").addClass("select-text");var t=e("<span />").addClass("select-button");this.element.append(t).append(this.textElement),this.select.css("display","none").after(this.element)},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None"),this.textElement.addClass("none");else if(2>=e.length){for(var t="",n=0,i=e.length;i>n;n++)t+=e[n].text,i-1>n&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Display.ListBox=function(){};t.prototype=new Selectioner.Display.Base,t.prototype.render=function(){this.element=e("<span />").addClass("select-display").prop("tabindex",this.select.prop("tabindex")),this.textElement=e("<span />").addClass("select-text");var t=e("<span />").addClass("select-button");this.element.append(t).append(this.textElement),this.select.css("display","none").after(this.element)},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None").addClass("none");else if(2>=e.length){for(var t="",n=0,i=e.length;i>n;n++)t+=e[n].text,i-1>n&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Display.ComboBox=function(t){this.textElement=e(t)};t.prototype=new Selectioner.Display.Base,t.prototype.render=function(){this.element=e("<span />").addClass("select-display").prop("tabindex",this.select.prop("tabindex")),this.textElement.addClass("select-text");var t=e("<span />").addClass("select-button").on("focus",function(){});this.element.append(t).append(this.textElement),this.select.css("display","none").after(this.element)},t.prototype.update=function(){var e=this.select.find("option:selected");this.textElement.removeClass("none");var t=e.text();0===e.length?this.textElement.addClass("none"):""!==t&&this.textElement.val(t)}}(),function(){var t=Selectioner.Dialog.Base=function(){};t.prototype.initialize=function(e){this.select=e},t.prototype.render=function(){for(var t=e("<ul />"),n=this.select.children(),i=0,s=n.length;s>i;i++){var o=e(n[i]);"OPTION"===n[i].tagName?t.append(this.renderOption(o)):"OPTGROUP"===n[i].tagName&&t.append(this.renderOptionGroup(o))}return t},t.prototype.copyData=function(e,t){var n=e.data();for(var i in n)t.attr("data-"+i,n[i])},t.prototype.copyCss=function(e,t){t.attr("style",e.attr("style"));for(var n=(e.attr("class")||"").split(" "),i=0,s=n.length;s>i;i++)t.addClass(n[i])}}(),function(){var t=Selectioner.Dialog.SingleSelect=function(){};t.prototype=new Selectioner.Dialog.Base,t.prototype.renderOption=function(t){var n=this.select,i=function(){t[0].selected=!0,n.trigger("change.selectioner")},s=e("<a />").attr("href","javascript:;").on("click",i).text(t.text());return this.copyData(t,s),this.copyCss(t,s),e("<li />").append(s)},t.prototype.renderOptionGroup=function(t){for(var n=e("<span />").text(t.attr("label")),i=e("<li />").addClass("select-group-title").append(n),s=t.children(),o=0,l=s.length;l>o;o++){var a=e(s[o]);i=i.add(this.renderOption(a))}var n=e("<li />").append(e("<ul >").append(i));return this.copyData(t,n),this.copyCss(t,n),n}}(),function(){var t=0,n=Selectioner.Dialog.MultiSelect=function(){};n.prototype=new Selectioner.Dialog.Base,n.prototype.renderOption=function(n){var i=e("<li />"),s="MultiSelectCheckbox"+t++,o=e('<input type="checkbox" />').attr("id",s);n[0].selected&&o.attr("checked","checked");var l=e("<label />").append(o).append(e("<span />").text(n.text())).attr("for",s),a=this;return o.on("change.selectioner",function(){n[0].selected=this.checked,a.select.trigger("change.selectioner")}),i.append(l),this.copyData(n,i),this.copyCss(n,i),i},n.prototype.renderOptionGroup=function(t){for(var n=function(){var t=e(this).closest("ul").find("input:checkbox"),n=t.filter(":checked").length;n>0&&t.length===n?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.selectioner")},i=e("<a />").attr("href","javascript:;").on("click",n).text(t.attr("label")),s=e("<li />").addClass("select-group-title").append(i),o=t.children(),l=0,a=o.length;a>l;l++){var r=e(o[l]);s=s.add(this.renderOption(r))}var i=e("<li />").append(e("<ul >").append(s));return this.copyData(t,i),this.copyCss(t,i),i}}(),e.fn.singleSelect=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.SingleSelect)})},e.fn.multiSelect=function(){this.filter("select[multiple]").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.MultiSelect)})},e.fn.comboSelect=function(t){this.filter("select:not([multiple])").each(function(){var n=new Selectioner.Display.ComboBox(t);n.initialize(e(this),new Selectioner.Dialog.SingleSelect)})}})(jQuery);