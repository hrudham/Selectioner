(function(e){Selectioner={Extensions:{},Dialog:{},Display:{},Popup:{}},function(){var t=Selectioner.Popup.Base=function(){};t.prototype.initialize=function(t,i,n){this.select=t,this.display=i,this.dialog=n,this.element=e("<div />").addClass("select-dialog").css({visibility:"hidden",position:"absolute",zIndex:"-1"}),this.render();var n=this,s=function(){n.isShown()?n.hide():n.show()},i=this.display;this.display.element.on("focusin.selectioner",function(){n.show()}).children().on("mousedown.selectioner",function(e){e.stopPropagation(),s()}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!n.isShown()||t.target===n.display.element[0]||e.contains(n.display.element[0],t.target)||t.target===n.element[0]||e.contains(n.element[0],t.target)||n.hide()}),e(window).on("resize.selectioner",function(){n.hide()}),e("body").append(this.element)},t.prototype.reposition=function(){var t=this.display.element.offset(),i=this.element.outerWidth(!1)-this.element.width(),n=this.display.element.outerWidth(!1)-i,s=this.display.element.outerHeight(!1)+t.top,o=e(window).scrollTop(),l=this.element.outerHeight(!0);this.element.removeClass("below").removeClass("above").removeClass("over"),s+l>window.innerHeight+o?(s=t.top-l+1,o>s?(s=o,this.element.addClass("over")):this.element.addClass("above")):this.element.addClass("below"),this.element.css({width:n+"px",left:t.left+"px",top:s+"px"})},t.prototype.render=function(){this.element.empty().append(this.dialog.render())},t.prototype.show=function(){this.render(),this.reposition(),this.element.css({visibility:"visible",zIndex:""}),this.select.trigger("show-dialog.selectioner"),this._isVisible=!0},t.prototype.hide=function(){this.element.css({visibility:"hidden",zIndex:"-1"}),this.select.trigger("hide-dialog.selectioner"),this._isVisible=!1},t.prototype.isShown=function(){return this._isVisible}}(),function(){var t=Selectioner.Display.Base=function(){};t.prototype.initialize=function(t,i){this.select=t;var n=t.attr("style"),s=(t.attr("class")||"").split(" "),o=t.data();this.render(),this.update(),this.element.attr("style",n);for(var l=0,a=s.length;a>l;l++)this.element.addClass(s[l]);for(var r in o)this.element.attr("data-"+r,o[r]);var c=this,p=t.attr("id");void 0!==p&&e('label[for="'+p+'"]').on("click",function(){c.element.focus()}),this.select.on("change.selectioner",function(){c.update()}).on("show-dialog.selectioner",function(){c.element.addClass("select-visible")}).on("hide-dialog.selectioner",function(){c.element.removeClass("select-visible")}),i.initialize(t);var d=new Selectioner.Popup.Base;d.initialize(t,this,i)},t.prototype.render=function(){this.element=e("<span />").addClass("select-display").prop("tabindex",this.select.prop("tabindex")),this.textElement=e("<span />").addClass("select-text");var t=e("<span />").addClass("select-button");this.element.append(t).append(this.textElement),this.select.css("display","none").after(this.element)},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None"),this.textElement.addClass("none");else if(2>=e.length){for(var t="",i=0,n=e.length;n>i;i++)t+=e[i].text,n-1>i&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Display.ListBox=function(){};t.prototype=new Selectioner.Display.Base,t.prototype.render=function(){this.element=e("<span />").addClass("select-display").prop("tabindex",this.select.prop("tabindex")),this.textElement=e("<span />").addClass("select-text");var t=e("<span />").addClass("select-button");this.element.append(t).append(this.textElement),this.select.css("display","none").after(this.element)},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None").addClass("none");else if(2>=e.length){for(var t="",i=0,n=e.length;n>i;i++)t+=e[i].text,n-1>i&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Display.ComboBox=function(t){this.textElement=e(t)};t.prototype=new Selectioner.Display.Base,t.prototype.render=function(){this.element=e("<span />").addClass("select-display").prop("tabindex",this.select.prop("tabindex")),this.textElement.addClass("select-text");var t=e("<span />").addClass("select-button").on("focus",function(){});this.element.append(t).append(this.textElement),this.select.css("display","none").after(this.element)},t.prototype.update=function(){var e=this.select.find("option:selected");this.textElement.removeClass("none");var t=e.text();0===e.length?this.textElement.addClass("none"):""!==t&&this.textElement.val(t)}}(),function(){var t=Selectioner.Dialog.Base=function(){};t.prototype.initialize=function(e){this.select=e},t.prototype.render=function(){for(var t=e("<ul />"),i=this.select.children(),n=0,s=i.length;s>n;n++){var o=e(i[n]);"OPTION"===i[n].tagName?t.append(this.renderOption(o)):"OPTGROUP"===i[n].tagName&&t.append(this.renderOptionGroup(o))}return t},t.prototype.copyData=function(e,t){var i=e.data();for(var n in i)t.attr("data-"+n,i[n])},t.prototype.copyCss=function(e,t){t.attr("style",e.attr("style"));for(var i=(e.attr("class")||"").split(" "),n=0,s=i.length;s>n;n++)t.addClass(i[n])}}(),function(){var t=Selectioner.Dialog.SingleSelect=function(){};t.prototype=new Selectioner.Dialog.Base,t.prototype.renderOption=function(t){var i=this.select,n=function(){t[0].selected=!0,i.trigger("change.selectioner")},s=e("<a />").attr("href","javascript:;").on("click",n).text(t.text());return this.copyData(t,s),this.copyCss(t,s),e("<li />").append(s)},t.prototype.renderOptionGroup=function(t){for(var i=e("<span />").text(t.attr("label")),n=e("<li />").addClass("select-group-title").append(i),s=t.children(),o=0,l=s.length;l>o;o++){var a=e(s[o]);n=n.add(this.renderOption(a))}var i=e("<li />").append(e("<ul >").append(n));return this.copyData(t,i),this.copyCss(t,i),i}}(),function(){var t=Selectioner.Dialog.MultiSelect=function(){};t._inputIdIndex=0,t.prototype=new Selectioner.Dialog.Base,t.prototype.renderOption=function(i){var n=e("<li />"),s="MultiSelectCheckbox"+t._inputIdIndex++,o=e('<input type="checkbox" />').attr("id",s);i[0].selected&&o.attr("checked","checked");var l=e("<label />").append(o).append(e("<span />").text(i.text())).attr("for",s),a=this;return o.on("change.selectioner",function(){i[0].selected=this.checked,a.select.trigger("change.selectioner")}),n.append(l),this.copyData(i,n),this.copyCss(i,n),n},t.prototype.renderOptionGroup=function(t){for(var i=function(){var t=e(this).closest("ul").find("input:checkbox"),i=t.filter(":checked").length;i>0&&t.length===i?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.selectioner")},n=e("<a />").attr("href","javascript:;").on("click",i).text(t.attr("label")),s=e("<li />").addClass("select-group-title").append(n),o=t.children(),l=0,a=o.length;a>l;l++){var r=e(o[l]);s=s.add(this.renderOption(r))}var n=e("<li />").append(e("<ul >").append(s));return this.copyData(t,n),this.copyCss(t,n),n}}(),e.fn.singleSelect=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.SingleSelect)})},e.fn.multiSelect=function(){this.filter("select[multiple]").each(function(){var t=new Selectioner.Display.ListBox;t.initialize(e(this),new Selectioner.Dialog.MultiSelect)})},e.fn.comboSelect=function(t){this.filter("select:not([multiple])").each(function(){var i=new Selectioner.Display.ComboBox(t);i.initialize(e(this),new Selectioner.Dialog.SingleSelect)})}})(jQuery);