(function(e){Selectioner={Core:{},Extensions:{},Views:{Dialogs:{},Displays:{}}},function(){var t=Selectioner.Core.Dialog=function(){};t.prototype.initialize=function(t,i,n){this.select=t,this.display=i,this.dialogView=n,this.element=e("<div />").addClass("select-dialog").css({display:"none",position:"absolute"}),this.render();var o=this;this.display.element.on("focusin.selectioner",function(){o.show(),i.element.on("mousedown.hide-select",function(){o.isShown()?o.hide():o.show()})}),e(document).on("mousedown.selectioner focusin.selectioner",function(t){!o.isShown()||t.target===o.display.element[0]||e.contains(o.display.element[0],t.target)||t.target===o.element[0]||e.contains(o.element[0],t.target)||(i.element.off("mousedown.hide-select"),o.hide())}),e("body").append(this.element)},t.prototype.reposition=function(){var e=this.display.element.offset(),t=this.element.outerWidth(!1)-this.element.width();this.element.css({width:this.display.element.outerWidth(!1)-t+"px",left:e.left+"px",top:this.display.element.outerHeight(!1)+e.top+"px"})},t.prototype.render=function(){this.element.empty().append(this.dialogView.render())},t.prototype.show=function(){this.render(),this.reposition(),this.element.css("display",""),this.select.trigger("show-dialog.selectioner")},t.prototype.hide=function(){this.element.css("display","none"),this.select.trigger("hide-dialog.selectioner")},t.prototype.isShown=function(){return this.element.is(":visible")}}(),function(){var t=Selectioner.Core.Display=function(){};t.prototype.initialize=function(t,i){this.select=t,this.render(),this.select.css("display","none").after(this.element);var n=this,o=t.attr("id");void 0!==o&&e('label[for="'+o+'"]').on("click",function(){n.element.focus()}),this.select.on("change.selectioner",function(){n.update()}).on("show-dialog.selectioner",function(){n.element.addClass("select-visible")}).on("hide-dialog.selectioner",function(){n.element.removeClass("select-visible")}),i.initialize(t);var s=new Selectioner.Core.Dialog;s.initialize(t,this,i)},t.prototype.render=function(){this.element=e("<span />").prop("tabindex",this.select.prop("tabindex")).addClass("select-display"),this.textElement=e("<span />").addClass("select-text"),this.button=e("<span />").addClass("select-button"),this.element.append(this.button).append(this.textElement),this.update()},t.prototype.update=function(){var e=this.select.find("option:selected");if(this.textElement.removeClass("none"),0==e.length)this.textElement.text("None"),this.textElement.addClass("none");else if(2>=e.length){for(var t="",i=0,n=e.length;n>i;i++)t+=e[i].text,n-1>i&&(t+=", ");this.textElement.text(t)}else this.textElement.text("Selected "+e.length+" of "+this.select.find("option").length)}}(),function(){var t=Selectioner.Views.Dialogs.Base=function(){};t.prototype.initialize=function(e){this.select=e},t.prototype.render=function(){for(var t=e("<ul />"),i=this.select.children(),n=0,o=i.length;o>n;n++){var s=e(i[n]);"OPTION"===i[n].tagName?t.append(this.renderOption(s)):"OPTGROUP"===i[n].tagName&&t.append(this.renderOptionGroup(s))}return t}}(),function(){var t=Selectioner.Views.Dialogs.SingleSelect=function(){};t.prototype=new Selectioner.Views.Dialogs.Base,t.prototype.renderOption=function(t){var i=this.select,n=function(){t[0].selected=!0,i.trigger("change.selectioner")},o=e("<a />").attr("href","javascript:;").on("click",n).text(t.text());return e("<li />").append(o)},t.prototype.renderOptionGroup=function(t){for(var i=e("<span />").text(t.attr("label")),n=e("<li />").addClass("select-group-title").append(i),o=t.children(),s=0,l=o.length;l>s;s++){var r=e(o[s]);n=n.add(this.renderOption(r))}return e("<li />").append(e("<ul >").append(n))}}(),function(){var t=0,i=Selectioner.Views.Dialogs.MultiSelect=function(){};i.prototype=new Selectioner.Views.Dialogs.Base,i.prototype.renderOption=function(i){var n=e("<li />"),o="MultiSelectCheckbox"+t++,s=e('<input type="checkbox" />').attr("id",o);i[0].selected&&s.attr("checked","checked");var l=e("<label />").append(s).append(e("<span />").text(i.text())).attr("for",o),r=this;return s.on("change.selectioner",function(){i[0].selected=this.checked,r.select.trigger("change.selectioner")}),n.append(l),n},i.prototype.renderOptionGroup=function(t){for(var i=function(){var t=e(this).closest("ul").find("input:checkbox"),i=t.filter(":checked").length;i>0&&t.length===i?t.prop("checked",!1):t.prop("checked",!0),t.trigger("change.selectioner")},n=e("<a />").attr("href","javascript:;").on("click",i).text(t.attr("label")),o=e("<li />").addClass("select-group-title").append(n),s=t.children(),l=0,r=s.length;r>l;l++){var a=e(s[l]);o=o.add(this.renderOption(a))}return e("<li />").append(e("<ul >").append(o))}}(),e.fn.select=function(){this.filter("select:not([multiple])").each(function(){var t=new Selectioner.Core.Display;t.initialize(e(this),new Selectioner.Views.Dialogs.SingleSelect)})},e.fn.multiselect=function(){this.filter("select[multiple]").each(function(){var t=new Selectioner.Core.Display;t.initialize(e(this),new Selectioner.Views.Dialogs.MultiSelect)})}})(jQuery);